{% extends "base.html" %}

{% block title %} | Account{% endblock %}

{% block main %}

<header class="section title">Account</header>

<div class='section'>

  <div class="setting">
    <div class="setting-title">Username</div>
    <div class="setting-body">
      <div class="acc-info">{{ data['username'] }}</div>
      <button class="change-btn margin-top" type="button" data-bs-toggle="collapse" data-bs-target="#changeUsername" aria-expanded="false" aria-controls="changeUsername">Change</button>
      <div class="collapse" id="changeUsername">
        <form class="form-row margin-top" name="change-username" action="{{ url_for('account', username=current_user.username) }}" method="POST">
          <input class="form-control width-auto" name="new-username" type="text" value="" placeholder="New username" pattern="[\w\d-_]{1,64}" title="letters, numbers, '-', '_'">
          <input class="btn btn-primary" type="submit" value="Change">
        </form>
      </div>
    </div>
  </div>

  <div class="setting">
    <div class="setting-title">E-mail</div>
    <div class="setting-body">
      <div class="acc-info">{{ data['email'] or "â€”" }}</div>
      <button class="change-btn margin-top" type="button" data-bs-toggle="collapse" data-bs-target="#changeEmail" aria-expanded="false" aria-controls="changeEmail">Change</button>
      <div class="collapse" id="changeEmail">
        <form class="form-row margin-top" name="change-email" action="{{ url_for('account', username=current_user.username) }}" method="POST">
          <input class="form-control width-auto" disabled name="new-email" type="text" value="" placeholder="New email">
          <input class="btn btn-primary" disabled type="submit" value="Change">
        </form>
      </div>
    </div>
  </div>

  <div class="setting">
    <div class="setting-title">Password</div>
    <div class="setting-body">
      <button class="change-btn" type="button" data-bs-toggle="collapse" data-bs-target="#changePassword" aria-expanded="false" aria-controls="changePassword">Change</button>
      <div class="collapse" id="changePassword">
        <form class="form-col margin-top" name="change-password" action="{{ url_for('account', username=current_user.username) }}" method="POST">
          <input class="form-control" name="old-password" type="password" value="" placeholder="Old password">
          <input class="form-control" name="new-password" type="password" value="" placeholder="New password">
          <input class="btn btn-primary" type="submit" value="Change">
        </form>
      </div>
    </div>
  </div>

  <div class="setting">
    <div class="setting-title">Timezone</div>
    <div class="setting-body">
      <div data-timezone="{{ data['timezone'] }}"></div>
      <form class="margin-top" name="change-timezone" action="{{ url_for('account', username=current_user.username) }}" method="POST">
        <input name="new-timezone" type="hidden" data-new-tz>
        <input class="change-btn" type="submit" value="Update">
      </form>
    </div>
  </div>

  <div class="setting">
    <div class="setting-title">Reports</div>
    <div class="setting-body">
      <form name="change-reports" action="{{ url_for('account', username=current_user.username) }}" method="POST">
        <div class="form-row">
          <div>Frequency:</div>
          <select class="form-select form-select-sm width-auto" name="new-report-frequency" data-rep-freq-select>
            <option value="month" {% if data['rep-freq'] == "month" %}data-rep-freq{% endif %}>Month</option>
            <option value="week" {% if data['rep-freq'] == "week" %}data-rep-freq{% endif %}>Week</option>
            {% if data['rep-freq'] != "month" and data['rep-freq'] != "week" %}<option value="custom" data-rep-freq>Custom</option>{% endif %}
            <option value="other">Other</option>
          </select>
          {% if data['rep-freq'] != "month" and data['rep-freq'] != "week" %}<span>every {{ data['rep-freq'] }} days</span>{% endif %}
          <input class="form-control form-control-sm form-hide width-auto" name="ndays" type="number" min="1" max="365" placeholder="Number of days" data-rep-freq-input>
        </div>
        <div class="form-row margin-top">
          <input class="form-check-input" disabled id="email-rep" type="checkbox" name="email-reports" value="true" {% if data['email-reports'] %} checked {% endif %}>
          <label class="form-check-label" for="email-rep">Send reports to e-mail</label>
        </div>
        <input class="change-btn margin-top" type="submit" value="Update">
      </form>
    </div>
  </div>

  <div class="setting">
    <div class="setting-title">Privacy</div>
    <div class="setting-body">
      <form name="export-data" action="{{ url_for('account', username=current_user.username) }}" method="POST">
        <input class="btn btn-success" type="submit" value="Export data">
        <input name="export-data" type="hidden" value="true">
      </form>
      <form class="margin-top" name="delete-account" action="{{ url_for('account', username=current_user.username) }}" method="POST" data-confirm-action="All your data will be deleted. Consider exporting your data first. This action cannot be undone.\n\nDelete account?">
        <input class="btn btn-danger" type="submit" value="Delete account">
        <input name="delete-account" type="hidden" value="true">
      </form>
    </div>
  </div>

</div>

{% endblock %}
